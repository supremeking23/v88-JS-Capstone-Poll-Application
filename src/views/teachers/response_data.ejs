<%- include('../includes/head')%>
	<body>
		<%- include('../includes/nav')%>

		<div class="mt-2 container">
			<!-- Page Layout here -->

            <div class="row mt-2">
                <div class="col s12">
                    <div class="card p-2">
                      
                            <div class="row">       
                                    <div id="chartContainer" style="height: 370px; width: 100%;"></div>
                            </div>
                       
                    </div>
                </div>
            </div>

            <div class="row mt-2">
                <div class="col s12">
                    <div class="card p-2">
                      <h4 class="mb-2">Voting tally with percentage</h4>
                      
                      <div class="percentage-section">
                          <!-- <div class="progress">
                              <span>Loki</span>
                              <div class="determinate " style="width: 70%; animation: grow 2s;">50%</div>
                          </div> -->
                      </div>
                        
                    </div>
                </div>
            </div>

            <div class="row mt-2">
                <div class="col s12">
                    <div class="card p-2">
                        <!-- <button type="button" class="btn btn-danger stop-collecting-button btn-large">Stop collecting response (<span class="live-vote-count">5 voted</span>,<span class="live-count">7 live</span>)</button> -->

                        <a role="button" class="btn btn-danger stop-collecting-button btn-large modal-trigger" href="#stop-collecting-prompt">Stop collecting response (<span class="live-vote-count">0 voted</span>,<span class="live-count">0 live</span>)</a>

                        <%- include('../includes/modal')%>
                       
                    </div>
                </div>
            </div>

            <div class="row mt-2">
                <div class="col s12">
                    <div class="card p-2">
                      <h4>Responses</h4>
                      <p>Invite your students to this url:google.com. Once students join this link, you can start collecting responses </p>

                    
                    </div>
                </div>
            </div>
		
		</div>
        <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
		<script>
            $(document).ready(function(){
                const socket = io();

                function load_response(){
                    $.get(`http://localhost:9000/teacher_response_data_json`,function(response){
                        let total_sum = 0;
                        for(let i =0; i < response.response_list.length;i++){
                            total_sum = response.response_list[i].y + total_sum;
                        }
                
                        let progress_bar = ``;
                        for(let i =0; i < response.response_list.length;i++){
                            progress_bar += `<div class="progress">`;
                            progress_bar += `   <span>${response.response_list[i].label}</span>`;
                            progress_bar += `   <div class="determinate " style="width:${isNaN((response.response_list[i].y/total_sum) * 100) ? 0 : (response.response_list[i].y/total_sum) * 100}%; animation: grow 2s;">${isNaN((response.response_list[i].y/total_sum) * 100) ? 0 : ((response.response_list[i].y/total_sum) * 100).toFixed(2)}%</div>`;
                            progress_bar += `</div>`;
                            
                        }
                        $(".percentage-section").html(progress_bar);

                        var chart = new CanvasJS.Chart("chartContainer", {
                            animationEnabled: true,
                            theme: "dark2", // "light1", "light2", "dark1", "dark2"
                            title:{
                                text: `<%= question %>`
                            },
                            axisY: {
                                title: ""
                            },
                            axisY:{
                                // interval: 10,
                                // suffix: "%" //going to workin in stacked bar
                            },
                            data: [{        
                                type: "column",  
                                showInLegend: true, 
                                legendMarkerColor: "grey",
                                legendText: "",
                                // dataPoints: [      
                                //     // { y: 300878, label: "Venezuela" },
                                //     // { y: 266455,  label: "Saudi" },
                                //     // { y: 169709,  label: "Canada" },
                                //     // { y: 158400,  label: "Iran" },
                                //     // { y: 142503,  label: "Iraq" },
                                //     // { y: 101500, label: "Kuwait" },
                                //     // { y: 97800,  label: "UAE" },
                            
                            
                                // ]

                                dataPoints: response.response_list

                            }]
                        });
                        chart.render();


                    },"json");
                }

                load_response()
                socket.on("update-poll-data",function(data){
                   
                    load_response();


                    // $.get(`http://localhost:9000/teacher_response_data_json`,function(response){

                    //     let total_sum = 0;
                    //     for(let i =0; i < response.response_list.length;i++){
                    //         total_sum = response.response_list[i].y + total_sum;
                    //     }
               
                    //     let progress_bar = ``;
                    //     for(let i =0; i < response.response_list.length;i++){
                    //         progress_bar += `<div class="progress">`;
                    //         progress_bar += `   <span>${response.response_list[i].label}</span>`;
                    //         progress_bar += `   <div class="determinate " style="width:${(response.response_list[i].y/total_sum) * 100}%; animation: grow 2s;">${(response.response_list[i].y/total_sum) * 100}%</div>`;
                    //         progress_bar += `</div>`;
                            
                    //     }
                    //     $(".percentage-section").html(progress_bar);

                        
                    //     var chart = new CanvasJS.Chart("chartContainer", {
                    //         animationEnabled: true,
                    //         theme: "dark2", // "light1", "light2", "dark1", "dark2"
                    //         title:{
                    //             text: `<%= question %>`
                    //         },
                    //         axisY: {
                    //             title: ""
                    //         },
                    //         axisY:{
                    //             // interval: 10,
                    //             // suffix: "%" //going to workin in stacked bar
                    //         },
                    //         data: [{        
                    //             type: "column",  
                    //             showInLegend: true, 
                    //             legendMarkerColor: "grey",
                    //             legendText: "",
                    //             dataPoints: response.response_list

                    //         }]
                    //     });
                    //     chart.render();


                    // },"json");
                });
                // update-poll-data
            });
        </script>
    </body>
</html>